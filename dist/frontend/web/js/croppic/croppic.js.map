{"version":3,"sources":["../../../../../frontend/web/js/croppic/croppic.js"],"names":["window","document","Croppic","id","options","that","obj","$","outputDiv","uploadUrl","uploadData","cropUrl","cropData","outputUrlId","imgEyecandy","imgEyecandyOpacity","zoomFactor","rotateFactor","doubleZoomControls","rotateControls","modal","customUploadButtonId","loaderHtml","scaleToFill","processInline","loadPicture","onReset","enableMousescroll","onBeforeImgUpload","onAfterImgUpload","onImgDrag","onImgZoom","onImgRotate","onBeforeImgCrop","onAfterImgCrop","onBeforeRemoveCroppedImg","onAfterRemoveCroppedImg","onError","i","init","prototype","imgInitW","imgInitH","imgW","imgH","objW","objH","actualRotation","windowW","windowH","height","outputUrlObj","img","defaultImg","croppedImg","form","iframeform","iframeobj","cropControlsUpload","cropControlsCrop","cropControlZoomMuchIn","cropControlZoomMuchOut","cropControlZoomIn","cropControlZoomOut","cropControlCrop","cropControlReset","cropControlRemoveCroppedImage","loader","width","isEmptyObject","find","createImgUploadControls","bindImgUploadControl","loadExistingImage","cropControlUpload","html","append","imgUploadControl","show","formHtml","fileUploadId","CreateFallbackIframe","off","on","trigger","Function","call","remove","hide","val","change","showLoader","FileReader","reset","reader","onload","e","image","Image","src","target","result","createModal","imgUrl","initCropper","hideLoader","readAsDataURL","files","formData","FormData","key","hasOwnProperty","ajax","url","data","context","body","cache","contentType","processData","type","always","afterUpload","load","response","jQuery","parseJSON","status","alert","message","setTimeout","marginTop","modalHTML","destroyModal","wrap","createCropControls","createEyecandy","initDrag","initialScaleImg","clone","css","appendTo","destroyEyecandy","zoom","event","preventDefault","deltaY","cropControlRotateLeft","cropControlRotateRight","rotate","crop","pageX","pageY","userAgent","navigator","match","undefined","originalEvent","touches","z_idx","drg_h","outerHeight","drg_w","outerWidth","pos_y","offset","top","pos_x","left","imgTop","imgLeft","removeClass","parseInt","maxTop","maxLeft","x","ratio","newWidth","newHeight","doPositioning","newTop","newLeft","imgY1","Math","abs","imgX1","cropH","cropW","rotation","XHR","XMLHttpRequest","urlEncodedData","urlEncodedDataPairs","push","encodeURIComponent","join","replace","addEventListener","onreadystatechange","readyState","afterCrop","responseText","open","setRequestHeader","length","send","err","destroy","attr","isAjaxUploadSupported","input","createElement","File","upload","iframe","setAttribute","style","display","appendChild","myContent","outerHTML","contentWindow","write","close","contents","SubmitFallbackIframe","attachEvent","eventHandlermyFile","detachEvent","removeEventListener","getIframeContentJSON","submit","doc","contentDocument","innerHTML","slice","toLowerCase","firstChild","nodeValue","success"],"mappings":"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","file":"croppic.js","sourcesContent":["/*\r\n * CROPPIC\r\n * dependancy: jQuery\r\n * author: Ognjen \"Zmaj Džedaj\" Božičković and Mat Steinlin\r\n */\r\n\r\n(function (window, document) {\r\n\r\n\tCroppic = function (id, options) {\r\n\r\n\t\tvar that = this;\r\n\t\tthat.id = id;\r\n\t\tthat.obj = $('#' + id);\r\n\t\tthat.outputDiv = that.obj;\r\n\r\n\t\t// DEFAULT OPTIONS\r\n\t\tthat.options = {\r\n\t\t\tuploadUrl:'',\r\n\t\t\tuploadData:{},\r\n\t\t\tcropUrl:'',\r\n\t\t\tcropData:{},\r\n\t\t\toutputUrlId:'',\r\n\t\t\t//styles\r\n\t\t\timgEyecandy:true,\r\n\t\t\timgEyecandyOpacity:0.2,\r\n\t\t\tzoomFactor:10,\r\n\t\t\trotateFactor:5,\r\n\t\t\tdoubleZoomControls:true,\r\n\t\t\trotateControls: true,\r\n\t\t\tmodal:false,\r\n\t\t\tcustomUploadButtonId:'',\r\n\t\t\tloaderHtml:'',\r\n\t\t\tscaleToFill: true,\r\n\t\t\tprocessInline: false,\r\n\t\t\tloadPicture:'',\r\n\t\t\tonReset: null,\r\n\t\t\tenableMousescroll: false, \t\t\t\r\n\t\t\t\r\n\t\t\t//callbacks\r\n\t\t\tonBeforeImgUpload: null,\r\n\t\t\tonAfterImgUpload: null,\r\n\t\t\tonImgDrag: null,\r\n\t\t\tonImgZoom: null,\r\n\t\t\tonImgRotate: null,\r\n\t\t\tonBeforeImgCrop: null,\r\n\t\t\tonAfterImgCrop: null,\r\n\t\t\tonBeforeRemoveCroppedImg: null,\r\n\t\t\tonAfterRemoveCroppedImg: null,\r\n\t\t\tonError: null,\r\n\t\t\t\r\n\t\t};\r\n\r\n\t\t// OVERWRITE DEFAULT OPTIONS\r\n\t\tfor (i in options) that.options[i] = options[i];\r\n\r\n\t\t// INIT THE WHOLE DAMN THING!!!\r\n\t\tthat.init();\r\n\t\t\r\n\t};\r\n\r\n\tCroppic.prototype = {\r\n\t\tid:'',\r\n\t\timgInitW:0,\r\n\t\timgInitH:0,\r\n\t\timgW:0,\r\n\t\timgH:0,\r\n\t\tobjW:0,\r\n\t\tobjH:0,\r\n\t\tactualRotation: 0,\r\n\t\twindowW:0,\r\n\t\twindowH:$(window).height(),\r\n\t\tobj:{},\r\n\t\toutputDiv:{},\r\n\t\toutputUrlObj:{},\r\n\t\timg:{},\r\n\t\tdefaultImg:{},\r\n\t\tcroppedImg:{},\r\n\t\timgEyecandy:{},\r\n\t\tform:{},\r\n\t\tiframeform: {},\r\n        iframeobj: {},\r\n\t\tcropControlsUpload:{},\r\n\t\tcropControlsCrop:{},\r\n\t\tcropControlZoomMuchIn:{},\r\n\t\tcropControlZoomMuchOut:{},\r\n\t\tcropControlZoomIn:{},\r\n        cropControlZoomOut:{},\r\n        cropControlCrop:{},\r\n\t\tcropControlReset:{},\t\r\n\t\tcropControlRemoveCroppedImage:{},\t\r\n\t\tmodal:{},\r\n\t\tloader:{},\r\n\t\t\r\n\t\tinit: function () {\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\tthat.objW = that.obj.width();\r\n\t\t\tthat.objH = that.obj.height();\r\n\t\t\t\r\n\t\t\t// reset rotation\r\n\t\t\tthat.actualRotation = 0;\r\n\t\t\t\r\n\t\t\tif( $.isEmptyObject(that.defaultImg)){ that.defaultImg = that.obj.find('img'); }\r\n\t\t\t\r\n\t\t\tthat.createImgUploadControls();\r\n\t\t\t\r\n\t\t\tif( $.isEmptyObject(that.options.loadPicture)){\t\t\t\t\r\n\t\t\t\tthat.bindImgUploadControl();\r\n\t\t\t}else{\t\t\t\t\r\n\t\t\t\tthat.loadExistingImage();\r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t},\r\n\t\tcreateImgUploadControls: function(){\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\tvar cropControlUpload = '';\r\n\t\t\tif(that.options.customUploadButtonId ===''){ cropControlUpload = '<i class=\"cropControlUpload\"></i>'; }\r\n\t\t\tvar cropControlRemoveCroppedImage = '<i class=\"cropControlRemoveCroppedImage\"></i>';\r\n\t\t\t\r\n\t\t\tif( $.isEmptyObject(that.croppedImg)){ cropControlRemoveCroppedImage=''; }\r\n\t\t\tif( !$.isEmptyObject(that.options.loadPicture)){ cropControlUpload='';}\r\n\r\n\t\t\tvar html =    '<div class=\"cropControls cropControlsUpload\"> ' + cropControlUpload + cropControlRemoveCroppedImage + ' </div>';\r\n\t\t\tthat.outputDiv.append(html);\r\n\t\t\t\r\n\t\t\tthat.cropControlsUpload = that.outputDiv.find('.cropControlsUpload');\r\n\t\t\t\r\n\t\t\tif(that.options.customUploadButtonId ===''){ that.imgUploadControl = that.outputDiv.find('.cropControlUpload'); }\r\n\t\t\telse{\tthat.imgUploadControl = $('#'+that.options.customUploadButtonId); that.imgUploadControl.show();\t}\r\n\r\n\t\t\tif( !$.isEmptyObject(that.croppedImg)){\r\n\t\t\t\tthat.cropControlRemoveCroppedImage = that.outputDiv.find('.cropControlRemoveCroppedImage');\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tbindImgUploadControl: function(){\r\n\t\t\t\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\t// CREATE UPLOAD IMG FORM\r\n            var formHtml = '<form class=\"' + that.id + '_imgUploadForm\" style=\"visibility: hidden;\">  <input type=\"file\" name=\"img\" id=\"' + that.id + '_imgUploadField\">  </form>';\r\n\t\t\tthat.outputDiv.append(formHtml);\r\n\t\t\tthat.form = that.outputDiv.find('.'+that.id+'_imgUploadForm');\r\n\t\t\t\r\n\t\t\t\r\n\t\t\t// CREATE FALLBACK IE9 IFRAME\r\n            var fileUploadId = that.CreateFallbackIframe();\r\n\t\t\t\r\n\t\t\tthat.imgUploadControl.off('click');\r\n\t\t\tthat.imgUploadControl.on('click',function(){ \r\n\t\t\t\tif (fileUploadId === \"\") {\r\n                    that.form.find('input[type=\"file\"]').trigger('click');\r\n                } else {\r\n                    //Trigger iframe file input click, otherwise access restriction error\r\n                    that.iframeform.find('input[type=\"file\"]').trigger('click');\r\n                }\t\t\t\t\t\t\t\t\t\r\n\t\t\t});\t\t\t\t\t\t\r\n\t\t\t\r\n\t\t\tif( !$.isEmptyObject(that.croppedImg)){\r\n\t\t\t\r\n\t\t\t\tthat.cropControlRemoveCroppedImage.on('click',function(){ \r\n\t\t\t\t\tif (typeof (that.options.onBeforeRemoveCroppedImg) === typeof(Function)) {\r\n\t\t\t\t\t\tthat.options.onBeforeRemoveCroppedImg.call(that);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tthat.croppedImg.remove();\r\n\t\t\t\t\tthat.croppedImg = {};\r\n\t\t\t\t\t$(this).hide();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (typeof (that.options.onAfterRemoveCroppedImg) === typeof(Function)) {\r\n\t\t\t\t\t\tthat.options.onAfterRemoveCroppedImg.call(that);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif( !$.isEmptyObject(that.defaultImg)){ \r\n\t\t\t\t\t\tthat.obj.append(that.defaultImg);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(that.options.outputUrlId !== ''){\t$('#'+that.options.outputUrlId).val('');\t}\r\n\t\t\t\t\r\n\t\t\t\t});\t\r\n\t\t\t\r\n\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\tthat.form.find('input[type=\"file\"]').change(function(){\r\n\t\t\t\t\r\n\t\t\t\tif (that.options.onBeforeImgUpload) that.options.onBeforeImgUpload.call(that);\r\n\t\t\t\t\r\n\t\t\t\tthat.showLoader();\r\n\t\t\t\tthat.imgUploadControl.hide();\r\n\t\t\t\t\r\n\t\t\t\tif(that.options.processInline){\t\t\t\r\n\t\t\t\t\t// Checking Browser Support for FileReader API\r\n\t\t\t\t    if (typeof FileReader == \"undefined\"){\r\n\t\t\t\t\t\tif (that.options.onError) that.options.onError.call(that,\"processInline is not supported by your Browser\");\r\n\t\t\t\t\t\tthat.reset();\r\n\t\t\t\t\t}else{\t\t\t\t\t\r\n\t\t\t\t\t\tvar reader = new FileReader();\t\t\t\t\t\r\n\t\t\t\t\t\treader.onload = function (e) {\r\n\t\t\t\t\t\t\tvar image = new Image();\r\n\t\t\t\t\t\t\timage.src = e.target.result;\r\n\t\t\t\t\t\t\timage.onload = function(){\r\n\t\t\t\t\t\t\t\tthat.imgInitW = that.imgW = image.width;\r\n\t\t\t\t\t\t\t\tthat.imgInitH = that.imgH = image.height;\r\n\r\n\t\t\t\t\t\t\t\tif(that.options.modal){\tthat.createModal(); }\r\n\t\t\t\t\t\t\t\tif( !$.isEmptyObject(that.croppedImg)){ that.croppedImg.remove(); }\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthat.imgUrl=image.src;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthat.obj.append('<img src=\"'+image.src+'\">');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tthat.initCropper();\r\n\t\t\t\t\t\t\t\tthat.hideLoader();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (that.options.onAfterImgUpload) that.options.onAfterImgUpload.call(that);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\treader.readAsDataURL(that.form.find('input[type=\"file\"]')[0].files[0]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\t\t\r\n\t\t\t\t\t\t\t\t\t    \t\t\t\t\t\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// other modern browsers\r\n\t\t\t\t\t\tformData = new FormData(that.form[0]);\r\n\t\t\t\t\t} catch(e) {\r\n\t\t\t\t\t\t// IE10 MUST have all form items appended as individual form key / value pairs\r\n\t\t\t\t\t\tformData = new FormData();\r\n\t\t\t\t\t\tformData.append('img', that.form.find(\"input[type=file]\")[0].files[0]);\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (var key in that.options.uploadData) {\r\n\t\t\t\t\t\tif( that.options.uploadData.hasOwnProperty(key) ) {\r\n\t\t\t\t\t\t\tformData.append( key , that.options.uploadData[key] );\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t\t$.ajax({\r\n\t\t\t\t\t\turl: that.options.uploadUrl,\r\n\t\t\t\t\t\tdata: formData,\r\n\t\t\t\t\t\tcontext: document.body,\r\n\t\t\t\t\t\tcache: false,\r\n\t\t\t\t\t\tcontentType: false,\r\n\t\t\t\t\t\tprocessData: false,\r\n\t\t\t\t\t\ttype: 'POST'\r\n\t\t\t\t\t}).always(function (data) {\r\n\t\t\t\t\t\tthat.afterUpload(data);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n            });\r\n\r\n        },\r\n\t\tloadExistingImage: function(){\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\tif( $.isEmptyObject(that.croppedImg)){\r\n\t\t\t\tif (that.options.onBeforeImgUpload) that.options.onBeforeImgUpload.call(that);\r\n\t\t\t\r\n\t\t\t\tthat.showLoader();\r\n\t\t\t\tif(that.options.modal){\tthat.createModal(); }\r\n\t\t\t\tif( !$.isEmptyObject(that.croppedImg)){ that.croppedImg.remove(); }\r\n\t\t\t\t\r\n\t\t\t\tthat.imgUrl=that.options.loadPicture ;\r\n\t\t\t\t\r\n\t\t\t\tvar img =$('<img src=\"'+ that.options.loadPicture +'\">');\r\n\t\t\t\tthat.obj.append(img);\r\n\t\t\t\timg.load(function() {\r\n\t\t\t\t\tthat.imgInitW = that.imgW = this.width;\r\n\t\t\t\t\tthat.imgInitH = that.imgH = this.height;\r\n\t\t\t\t\tthat.initCropper();\r\n\t\t\t\t\tthat.hideLoader();\r\n\t\t\t\t\tif (that.options.onAfterImgUpload) that.options.onAfterImgUpload.call(that);\r\n\t\t\t\t});\t\r\n\t\t\t\t\t\t\r\n\t\t\t}else{\t\t\t\t\t\r\n\t\t\t\tthat.cropControlRemoveCroppedImage.on('click',function(){ \r\n\t\t\t\t\tthat.croppedImg.remove();\r\n\t\t\t\t\t$(this).hide();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif( !$.isEmptyObject(that.defaultImg)){ \r\n\t\t\t\t\t\tthat.obj.append(that.defaultImg);\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\tif(that.options.outputUrlId !== ''){\t$('#'+that.options.outputUrlId).val('');\t}\r\n\t\t\t\t\tthat.croppedImg = '';\r\n\t\t\t\t\tthat.reset();\r\n\t\t\t\t});\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tafterUpload: function(data){\r\n            var that = this;\r\n\r\n           \tresponse = typeof data =='object' ? data : jQuery.parseJSON(data);\r\n\r\n            \r\n            if (response.status == 'success') {\r\n\r\n                that.imgInitW = that.imgW = response.width;\r\n                that.imgInitH = that.imgH = response.height;\r\n\r\n                if (that.options.modal) { that.createModal(); }\r\n                if (!$.isEmptyObject(that.croppedImg)) { that.croppedImg.remove(); }\r\n\r\n                that.imgUrl = response.url;\r\n\r\n                var img = $('<img src=\"'+response.url+'\">')\r\n\r\n\t\t\t\tthat.obj.append(img);\r\n\r\n\t\t\t\timg.load(function(){\r\n\t\t\t\t\tthat.initCropper();\r\n\t\t\t\t\tthat.hideLoader();\r\n\t\t\t\t\tif (that.options.onAfterImgUpload) that.options.onAfterImgUpload.call(that);\r\n\t\t\t\t});\r\n                                \r\n                if (that.options.onAfterImgUpload) that.options.onAfterImgUpload.call(that);\r\n\r\n            }\r\n\r\n            if (response.status == 'error') {\r\n\t\t\t    alert(response.message);\r\n                if (that.options.onError) that.options.onError.call(that,response.message);\r\n\t\t\t\tthat.hideLoader();\r\n\t\t\t\tsetTimeout( function(){ that.reset(); },2000)\t\r\n            }\r\n        },\r\n\t\t\r\n\t\tcreateModal: function(){\r\n\t\t\tvar that = this;\r\n\t\t\r\n\t\t\tvar marginTop = that.windowH/2-that.objH/2;\r\n\t\t\tvar modalHTML =  '<div id=\"croppicModal\">'+'<div id=\"croppicModalObj\" style=\"width:'+ that.objW +'px; height:'+ that.objH +'px; margin:0 auto; margin-top:'+ marginTop +'px; position: relative;\"> </div>'+'</div>';\r\n\r\n\t\t\t$('body').append(modalHTML);\r\n\t\t\t\r\n\t\t\tthat.modal = $('#croppicModal');\r\n\t\t\t\r\n\t\t\tthat.obj = $('#croppicModalObj');\r\n\t\t\t\r\n\t\t},\r\n\t\tdestroyModal: function(){\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\tthat.obj = that.outputDiv;\r\n\t\t\tthat.modal.remove();\r\n\t\t\tthat.modal = {};\r\n\t\t},\r\n\t\tinitCropper: function(){\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\t/*SET UP SOME VARS*/\r\n\t\t\tthat.img = that.obj.find('img');\r\n\t\t\tthat.img.wrap('<div class=\"cropImgWrapper\" style=\"overflow:hidden; z-index:1; position:absolute; width:'+that.objW+'px; height:'+that.objH+'px;\"></div>');\r\n\t\r\n\t\t\t/*INIT DRAGGING*/\r\n\t\t\tthat.createCropControls();\r\n\t\t\t\r\n\t\t\tif(that.options.imgEyecandy){ that.createEyecandy(); }\r\n\t\t\tthat.initDrag();\r\n\t\t\tthat.initialScaleImg();\r\n\t\t},\r\n\t\tcreateEyecandy: function(){\r\n\t\t\tvar that = this;\r\n\r\n\t\t\tthat.imgEyecandy = that.img.clone();\r\n\t\t\tthat.imgEyecandy.css({'z-index':'0','opacity':that.options.imgEyecandyOpacity}).appendTo(that.obj);\r\n\t\t},\r\n\t\tdestroyEyecandy: function(){\r\n\t\t\tvar that = this;\r\n\t\t\tthat.imgEyecandy.remove();\r\n\t\t},\r\n\t\tinitialScaleImg:function(){\r\n\t\t\tvar that = this;\r\n\t\t\tthat.zoom(-that.imgInitW);\r\n\t\t\tthat.zoom(40);\r\n\t\t\t\r\n\t\t\t// Adding mousewheel zoom capabilities\r\n\t\t\tif (that.options.enableMousescroll){\r\n\t\t\t\tthat.img.on('mousewheel', function(event) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tthat.zoom(that.options.zoomFactor*event.deltaY);\t\t\t\t\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t// initial center image\r\n\t\t\t\r\n\t\t\tthat.img.css({'left': -(that.imgW -that.objW)/2, 'top': -(that.imgH -that.objH)/2, 'position':'relative'});\r\n\t\t\tif(that.options.imgEyecandy){ that.imgEyecandy.css({'left': -(that.imgW -that.objW)/2, 'top': -(that.imgH -that.objH)/2, 'position':'relative'}); }\r\n\t\t\t\r\n\t\t},\r\n\t\t\r\n\t\tcreateCropControls: function(){\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\t// CREATE CONTROLS\r\n\t\t\tvar cropControlZoomMuchIn =      '';\r\n\t\t\tvar cropControlZoomIn =          '<i class=\"cropControlZoomIn\"></i>';\r\n\t\t\tvar cropControlZoomOut =         '<i class=\"cropControlZoomOut\"></i>';\r\n\t\t\tvar cropControlZoomMuchOut =     '';\r\n\t\t\tvar cropControlRotateLeft =      '';\r\n\t        var cropControlRotateRight =     '';\r\n\t        var cropControlCrop =            '<i class=\"cropControlCrop\"></i>';\r\n\t\t\tvar cropControlReset =           '<i class=\"cropControlReset\"></i>';\r\n\t\t\t\r\n            var html;\r\n            \r\n\t\t\tif(that.options.doubleZoomControls){\r\n\t\t\t\tcropControlZoomMuchIn = '<i class=\"cropControlZoomMuchIn\"></i>';\r\n\t\t\t\tcropControlZoomMuchOut = '<i class=\"cropControlZoomMuchOut\"></i>';\r\n\t\t\t}\r\n\t\t\tif(that.options.rotateControls){\r\n\t\t\t\tcropControlRotateLeft = '<i class=\"cropControlRotateLeft\"></i>';\r\n\t\t\t\tcropControlRotateRight = '<i class=\"cropControlRotateRight\"></i>';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\thtml =  '<div class=\"cropControls cropControlsCrop\">'+ cropControlZoomMuchIn + cropControlZoomIn + cropControlZoomOut + cropControlZoomMuchOut + cropControlRotateLeft + cropControlRotateRight + cropControlCrop + cropControlReset + '</div>';\r\n\t\t\t\t\t\t\r\n\t\t\tthat.obj.append(html);\r\n\t\t\t\r\n\t\t\tthat.cropControlsCrop = that.obj.find('.cropControlsCrop');\r\n\r\n\t\t\t// CACHE AND BIND CONTROLS\r\n\t\t\tif(that.options.doubleZoomControls){\r\n\t\t\t\tthat.cropControlZoomMuchIn = that.cropControlsCrop.find('.cropControlZoomMuchIn');\r\n\t\t\t\tthat.cropControlZoomMuchIn.on('click',function(){ that.zoom( that.options.zoomFactor*10 ); });\r\n\t\t\t\r\n\t\t\t\tthat.cropControlZoomMuchOut = that.cropControlsCrop.find('.cropControlZoomMuchOut');\r\n\t\t\t\tthat.cropControlZoomMuchOut.on('click',function(){ that.zoom(-that.options.zoomFactor*10); });\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthat.cropControlZoomIn = that.cropControlsCrop.find('.cropControlZoomIn');\r\n\t\t\tthat.cropControlZoomIn.on('click',function(){ that.zoom(that.options.zoomFactor); });\r\n\r\n\t\t\tthat.cropControlZoomOut = that.cropControlsCrop.find('.cropControlZoomOut');\r\n\t\t\tthat.cropControlZoomOut.on('click',function(){ that.zoom(-that.options.zoomFactor); });\t\t\r\n\r\n\t\t\tthat.cropControlZoomIn = that.cropControlsCrop.find('.cropControlRotateLeft');\r\n\t        that.cropControlZoomIn.on('click', function() { that.rotate(-that.options.rotateFactor); });\r\n\t        \r\n\t        that.cropControlZoomOut = that.cropControlsCrop.find('.cropControlRotateRight');\r\n\t        that.cropControlZoomOut.on('click', function() { that.rotate(that.options.rotateFactor); });\r\n\t        \r\n\t        that.cropControlCrop = that.cropControlsCrop.find('.cropControlCrop');\r\n\t\t\tthat.cropControlCrop.on('click',function(){ that.crop(); });\r\n\r\n\t\t\tthat.cropControlReset = that.cropControlsCrop.find('.cropControlReset');\r\n\t\t\tthat.cropControlReset.on('click',function(){ that.reset(); });\t\t\t\t\r\n\t\t\t\r\n\t\t},\r\n\t\tinitDrag:function(){\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\tthat.img.on(\"mousedown touchstart\", function(e) {\r\n\t\t\t\t\r\n\t\t\t\te.preventDefault(); // disable selection\r\n\t\t\t\t\r\n\t\t\t\tvar pageX;\r\n                var pageY;\r\n                var userAgent = window.navigator.userAgent;\r\n                if (userAgent.match(/iPad/i) || userAgent.match(/iPhone/i) || userAgent.match(/android/i) || (e.pageY && e.pageX) == undefined) {\r\n                    pageX = e.originalEvent.touches[0].pageX;\r\n                    pageY = e.originalEvent.touches[0].pageY;\r\n                } else {\r\n                    pageX = e.pageX;\r\n                    pageY = e.pageY;\r\n                }\r\n\t\t\t\t\r\n\t\t\t\tvar z_idx = that.img.css('z-index'),\r\n                drg_h = that.img.outerHeight(),\r\n                drg_w = that.img.outerWidth(),\r\n                pos_y = that.img.offset().top + drg_h - pageY,\r\n                pos_x = that.img.offset().left + drg_w - pageX;\r\n\t\t\t\t\r\n\t\t\t\tthat.img.css('z-index', 1000).on(\"mousemove touchmove\", function(e) {\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar imgTop;\r\n\t\t\t\t\tvar imgLeft;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (userAgent.match(/iPad/i) || userAgent.match(/iPhone/i) || userAgent.match(/android/i) || (e.pageY && e.pageX) == undefined) {\r\n                        imgTop = e.originalEvent.touches[0].pageY + pos_y - drg_h;\r\n                        imgLeft = e.originalEvent.touches[0].pageX + pos_x - drg_w;\r\n                    } else {\r\n                        imgTop = e.pageY + pos_y - drg_h;\r\n                        imgLeft = e.pageX + pos_x - drg_w;\r\n                    }\r\n\t\t\t\t\t\r\n\t\t\t\t\tthat.img.offset({\r\n\t\t\t\t\t\ttop:imgTop,\r\n\t\t\t\t\t\tleft:imgLeft\r\n\t\t\t\t\t}).on(\"mouseup\", function() {\r\n\t\t\t\t\t\t$(this).removeClass('draggable').css('z-index', z_idx);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t\r\n\t\t\t\t\tif(that.options.imgEyecandy){ that.imgEyecandy.offset({ top:imgTop, left:imgLeft }); }\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tif (that.objH < that.imgH) {\r\n\t\t\t\t\t\tif (parseInt(that.img.css('top')) > 0) { that.img.css('top', 0); if (that.options.imgEyecandy) { that.imgEyecandy.css('top', 0);}}\r\n\t\t\t\t\t\tvar maxTop = -( that.imgH - that.objH); if (parseInt(that.img.css('top')) < maxTop) { that.img.css('top', maxTop); if (that.options.imgEyecandy) { that.imgEyecandy.css('top', maxTop); }}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif (parseInt(that.img.css('top')) < 0) { that.img.css('top', 0); if (that.options.imgEyecandy) { that.imgEyecandy.css('top', 0); }}\r\n\t\t\t\t\t\tvar maxTop =  that.objH - that.imgH; if (parseInt(that.img.css('top')) > maxTop) { that.img.css('top', maxTop);if (that.options.imgEyecandy) {that.imgEyecandy.css('top', maxTop); }}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (that.objW < that.imgW) {\r\n\t\t\t\t\t\tif( parseInt( that.img.css('left')) > 0 ){ that.img.css('left',0); if(that.options.imgEyecandy){ that.imgEyecandy.css('left', 0); }}\r\n\t\t\t\t\t\tvar maxLeft = -( that.imgW-that.objW); if( parseInt( that.img.css('left')) < maxLeft){ that.img.css('left', maxLeft); if(that.options.imgEyecandy){ that.imgEyecandy.css('left', maxLeft); } }\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tif( parseInt( that.img.css('left')) < 0 ){ that.img.css('left',0); if(that.options.imgEyecandy){ that.imgEyecandy.css('left', 0); }}\r\n\t\t\t\t\t\tvar maxLeft = ( that.objW - that.imgW); if( parseInt( that.img.css('left')) > maxLeft){ that.img.css('left', maxLeft); if(that.options.imgEyecandy){ that.imgEyecandy.css('left', maxLeft); } }\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (that.options.onImgDrag) that.options.onImgDrag.call(that);\r\n\t\t\t\t\t\r\n\t\t\t\t});\r\n\t\r\n\t\t\t}).on(\"mouseup\", function() {\r\n\t\t\t\tthat.img.off(\"mousemove\");\r\n\t\t\t}).on(\"mouseout\", function() {\r\n\t\t\t\tthat.img.off(\"mousemove\");\r\n\t\t\t});\r\n\t\t\t\r\n\t\t},\r\n\t    rotate: function(x) {\r\n\t        var that = this;\r\n\t        that.actualRotation += x;\r\n\t        that.img.css({\r\n\t            '-webkit-transform': 'rotate(' + that.actualRotation + 'deg)',\r\n\t            '-moz-transform': 'rotate(' + that.actualRotation + 'deg)',\r\n\t            'transform': 'rotate(' + that.actualRotation + 'deg)',\r\n\t        });\r\n\t        if(that.options.imgEyecandy) {\r\n\t            that.imgEyecandy.css({\r\n\t                '-webkit-transform': 'rotate(' + that.actualRotation + 'deg)',\r\n\t                '-moz-transform': 'rotate(' + that.actualRotation + 'deg)',\r\n\t                'transform': 'rotate(' + that.actualRotation + 'deg)',\r\n\t            });\r\n\t        }\r\n\t        if (typeof that.options.onImgRotate == 'function')\r\n\t            that.options.onImgRotate.call(that);\r\n\t    },\r\n\t\tzoom :function(x){\r\n\t\t\tvar that = this;\r\n\t\t\tvar ratio = that.imgW / that.imgH;\r\n\t\t\tvar newWidth = that.imgW+x;\r\n\t\t\tvar newHeight = newWidth/ratio;\r\n\t\t\tvar doPositioning = true;\r\n\t\t\t\r\n\t\t\tif( newWidth < that.objW || newHeight < that.objH){\r\n\t\t\t\t\r\n\t\t\t\tif( newWidth - that.objW < newHeight - that.objH ){ \r\n\t\t\t\t\tnewWidth = that.objW;\r\n\t\t\t\t\tnewHeight = newWidth/ratio;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tnewHeight = that.objH;\r\n\t\t\t\t\tnewWidth = ratio * newHeight;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tdoPositioning = false;\r\n\t\t\t\t\r\n\t\t\t} \r\n\t\t\t\r\n\t\t\tif(!that.options.scaleToFill && (newWidth > that.imgInitW || newHeight > that.imgInitH)){\r\n\t\t\t\t\r\n\t\t\t\tif( newWidth - that.imgInitW < newHeight - that.imgInitH ){ \r\n\t\t\t\t\tnewWidth = that.imgInitW;\r\n\t\t\t\t\tnewHeight = newWidth/ratio;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tnewHeight = that.imgInitH;\r\n\t\t\t\t\tnewWidth = ratio * newHeight;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tdoPositioning = false;\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthat.imgW = newWidth;\r\n\t\t\tthat.img.width(newWidth); \r\n\t\t\t\r\n\t\t\tthat.imgH = newHeight;\r\n\t\t\tthat.img.height(newHeight); \r\n\t\r\n\t\t\tvar newTop = parseInt( that.img.css('top') ) - x/2;\r\n\t\t\tvar newLeft = parseInt( that.img.css('left') ) - x/2;\r\n\t\t\t\r\n\t\t\tif( newTop>0 ){ newTop=0;}\r\n\t\t\tif( newLeft>0 ){ newLeft=0;}\r\n\t\t\t\r\n\t\t\tvar maxTop = -( newHeight-that.objH); if( newTop < maxTop){\tnewTop = maxTop;\t}\r\n\t\t\tvar maxLeft = -( newWidth-that.objW); if( newLeft < maxLeft){\tnewLeft = maxLeft;\t}\r\n\t\t\t\r\n\t\t\tif( doPositioning ){\r\n\t\t\t\tthat.img.css({'top':newTop, 'left':newLeft}); \r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(that.options.imgEyecandy){\r\n\t\t\t\tthat.imgEyecandy.width(newWidth);\r\n\t\t\t\tthat.imgEyecandy.height(newHeight);\r\n\t\t\t\tif( doPositioning ){\r\n\t\t\t\t\tthat.imgEyecandy.css({'top':newTop, 'left':newLeft}); \r\n\t\t\t\t}\r\n\t\t\t}\t\r\n\t\t\t\r\n\t\t\tif (that.options.onImgZoom) that.options.onImgZoom.call(that);\r\n\r\n\t\t},\r\n\t\tcrop:function(){\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\tif (that.options.onBeforeImgCrop) that.options.onBeforeImgCrop.call(that);\r\n\t\t\t\r\n\t\t\tthat.cropControlsCrop.hide();\r\n\t\t\tthat.showLoader();\r\n\t\r\n\t\t\tvar cropData = {\r\n\t\t\t\t\timgUrl:that.imgUrl,\r\n\t\t\t\t\timgInitW:that.imgInitW,\r\n\t\t\t\t\timgInitH:that.imgInitH,\r\n\t\t\t\t\timgW:that.imgW,\r\n\t\t\t\t\timgH:that.imgH,\r\n\t\t\t\t\timgY1:Math.abs( parseInt( that.img.css('top') ) ),\r\n\t\t\t\t\timgX1:Math.abs( parseInt( that.img.css('left') ) ),\r\n\t\t\t\t\tcropH:that.objH,\r\n\t\t\t\t\tcropW:that.objW,\r\n\t\t\t\t\trotation:that.actualRotation\r\n\t\t\t\t};\r\n\t\t\t\r\n\t\t\tvar formData;\r\n\t\t\t\r\n\t\t\tif(typeof FormData == 'undefined'){\r\n\t\t\t\tvar XHR = new XMLHttpRequest();\r\n\t\t\t\tvar urlEncodedData = \"\";\r\n\t\t\t\tvar urlEncodedDataPairs = [];\r\n\t\t\t\t\r\n\t\t\t\tfor(var key in cropData) {\r\n\t\t\t\t  urlEncodedDataPairs.push(encodeURIComponent(key) + '=' + encodeURIComponent(cropData[key]));\r\n\t\t\t\t}\r\n\t\t\t\tfor(var key in that.options.cropData) {\r\n\t\t\t\t  urlEncodedDataPairs.push(encodeURIComponent(key) + '=' + encodeURIComponent(that.options.cropData[key]));\r\n\t\t\t\t}\r\n\t\t\t\turlEncodedData  = urlEncodedDataPairs.join('&').replace(/%20/g, '+');\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tXHR.addEventListener('error', function(event) {\r\n\t\t\t\t\tif (that.options.onError) that.options.onError.call(that,\"XHR Request failed\");\r\n\t\t\t\t});\r\n\t\t\t\tXHR.onreadystatechange=function(){\r\n\t\t\t\tif (XHR.readyState==4 && XHR.status==200)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthat.afterCrop(XHR.responseText);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tXHR.open('POST', that.options.cropUrl);\r\n\r\n\t\t\t\tXHR.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n\t\t\t\tXHR.setRequestHeader('Content-Length', urlEncodedData.length);\r\n\r\n\t\t\t\tXHR.send(urlEncodedData);\r\n\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\tformData = new FormData();\r\n\t\t\t\tfor (var key in cropData) {\t\t\t\t\r\n\t\t\t\t\tif( cropData.hasOwnProperty(key) ) {\r\n\t\t\t\t\t\t\tformData.append( key , cropData[key] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfor (var key in that.options.cropData) {\r\n\t\t\t\t\tif( that.options.cropData.hasOwnProperty(key) ) {\r\n\t\t\t\t\t\t\tformData.append( key , that.options.cropData[key] );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t$.ajax({\r\n\t\t\t\t\turl: that.options.cropUrl,\r\n\t\t\t\t\tdata: formData,\r\n\t\t\t\t\tcontext: document.body,\r\n\t\t\t\t\tcache: false,\r\n\t\t\t\t\tcontentType: false,\r\n\t\t\t\t\tprocessData: false,\r\n\t\t\t\t\ttype: 'POST'\t\t\t\t\r\n\t\t\t\t}).always(function (data) {\r\n\r\n\t\t\t\t\tthat.afterCrop(data);\r\n\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t//\r\n        },\r\n\t\tafterCrop: function (data) {\r\n            var that = this;\r\n\t\t\ttry {\r\n\t\t\t\tresponse = jQuery.parseJSON(data);           \t\r\n\t\t\t}\r\n\t\t\tcatch(err) {\r\n\t\t\t\tresponse = typeof data =='object' ? data : jQuery.parseJSON(data);           \t\r\n\t\t\t}\t    \r\n           \t\r\n            if (response.status == 'success') {\r\n\r\n                if (that.options.imgEyecandy)\r\n\t\t\t\t\tthat.imgEyecandy.hide();\r\n\r\n                that.destroy();\r\n\t\t\t\t\r\n                that.obj.append('<img class=\"croppedImg\" src=\"' + response.url + '\">');\r\n                if (that.options.outputUrlId !== '') { $('#' + that.options.outputUrlId).val(response.url); }\r\n\r\n                that.croppedImg = that.obj.find('.croppedImg');\r\n\r\n                that.init();\r\n\r\n                that.hideLoader();\r\n\t\t    }\r\n            if (response.status == 'error') {\r\n                if (that.options.onError) that.options.onError.call(that,response.message);\r\n\t\t\t\tthat.hideLoader();\r\n\t\t\t\tsetTimeout( function(){ that.reset(); },2000)\t\r\n            }\r\n\r\n            if (that.options.onAfterImgCrop) that.options.onAfterImgCrop.call(that, response);\r\n        },\r\n\t\tshowLoader:function(){\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\tthat.obj.append(that.options.loaderHtml);\r\n\t\t\tthat.loader = that.obj.find('.loader');\r\n\t\t\t\r\n\t\t},\r\n\t\thideLoader:function(){\r\n\t\t\tvar that = this;\r\n\t\t\tthat.loader.remove();\t\r\n\t\t},\r\n\t\treset:function(){\r\n\t\t\tvar that = this;\r\n\t\t\tthat.destroy();\r\n\t\t\t\r\n\t\t\tthat.init();\r\n\t\t\t\r\n\t\t\tif( !$.isEmptyObject(that.croppedImg)){ \r\n\t\t\t\tthat.obj.append(that.croppedImg); \r\n\t\t\t\tif(that.options.outputUrlId !== ''){\t$('#'+that.options.outputUrlId).val(that.croppedImg.attr('url'));\t}\r\n\t\t\t}\r\n\t\t\tif (typeof that.options.onReset == 'function')\r\n                that.options.onReset.call(that);\r\n\t\t},\r\n\t\tdestroy:function(){\r\n\t\t\tvar that = this;\r\n\t\t\tif(that.options.modal && !$.isEmptyObject(that.modal) ){ that.destroyModal(); }\r\n\t\t\tif(that.options.imgEyecandy && !$.isEmptyObject(that.imgEyecandy) ){  that.destroyEyecandy(); }\r\n\t\t\tif( !$.isEmptyObject( that.cropControlsUpload ) ){  that.cropControlsUpload.remove(); }\r\n\t\t\tif( !$.isEmptyObject( that.cropControlsCrop ) ){   that.cropControlsCrop.remove(); }\r\n\t\t\tif( !$.isEmptyObject( that.loader ) ){   that.loader.remove(); }\r\n\t\t\tif( !$.isEmptyObject( that.form ) ){   that.form.remove(); }\r\n\t\t\tthat.obj.html('');\r\n\t\t},\r\n\t\tisAjaxUploadSupported: function () {\r\n            var input = document.createElement(\"input\");\r\n            input.type = \"file\";\r\n\r\n            return (\r\n                \"multiple\" in input &&\r\n                    typeof File != \"undefined\" &&\r\n                    typeof FormData != \"undefined\" &&\r\n                    typeof (new XMLHttpRequest()).upload != \"undefined\");\r\n        },\r\n        CreateFallbackIframe: function () {\r\n            var that = this;        \r\n\t\t\t\r\n            if (!that.isAjaxUploadSupported()) { \r\n\r\n                if (jQuery.isEmptyObject(that.iframeobj)) {\r\n                    var iframe = document.createElement(\"iframe\");\r\n                    iframe.setAttribute(\"id\", that.id + \"_upload_iframe\");\r\n                    iframe.setAttribute(\"name\", that.id + \"_upload_iframe\");\r\n                    iframe.setAttribute(\"width\", \"0\");\r\n                    iframe.setAttribute(\"height\", \"0\");\r\n                    iframe.setAttribute(\"border\", \"0\");\r\n                    iframe.setAttribute(\"src\", \"javascript:false;\");\r\n                    iframe.style.display = \"none\";\r\n                    document.body.appendChild(iframe);\r\n                } else {\r\n                    iframe = that.iframeobj[0];\r\n                }\r\n\r\n                var myContent = '<!DOCTYPE html>'\r\n                                + '<html><head><title>Uploading File</title></head>'\r\n                                + '<body>'\r\n                                + '<form '\r\n                                + 'class=\"' + that.id + '_upload_iframe_form\" '                               \r\n                                + 'name=\"' + that.id + '_upload_iframe_form\" '\r\n                                + 'action=\"' + that.options.uploadUrl + '\" method=\"post\" '\r\n                                + 'enctype=\"multipart/form-data\" encoding=\"multipart/form-data\" style=\"display:none;\">'\r\n                                + $(\"#\" + that.id + '_imgUploadField')[0].outerHTML\r\n                                + '</form></body></html>';\r\n\r\n                iframe.contentWindow.document.open('text/htmlreplace');\r\n                iframe.contentWindow.document.write(myContent);\r\n                iframe.contentWindow.document.close();\r\n\r\n                that.iframeobj = $(\"#\" + that.id + \"_upload_iframe\");                \r\n                that.iframeform = that.iframeobj.contents().find(\"html\").find(\".\" + that.id + \"_upload_iframe_form\");\r\n                \r\n                that.iframeform.on(\"change\", \"input\", function () {                   \r\n\t\t\t\t\tthat.SubmitFallbackIframe(that);\r\n                });\r\n                that.iframeform.find(\"input\")[0].attachEvent(\"onchange\", function () {\r\n                    that.SubmitFallbackIframe(that);\r\n                });\r\n                \r\n                var eventHandlermyFile = function () {\r\n                    if (iframe.detachEvent)\r\n                        iframe.detachEvent(\"onload\", eventHandlermyFile);\r\n                    else\r\n                        iframe.removeEventListener(\"load\", eventHandlermyFile, false);\r\n\r\n                    var response = that.getIframeContentJSON(iframe);\r\n\r\n                    if (jQuery.isEmptyObject(that.modal)) {\r\n                        that.afterUpload(response);\r\n                    }\r\n                }\r\n\r\n                if (iframe.addEventListener)\r\n                    iframe.addEventListener(\"load\", eventHandlermyFile, true);\r\n                if (iframe.attachEvent)\r\n                    iframe.attachEvent(\"onload\", eventHandlermyFile);\r\n\r\n                return \"#\" + that.id + '_imgUploadField';\r\n                \r\n            } else {\r\n                return \"\";\r\n            }\r\n\r\n        },\r\n        SubmitFallbackIframe: function (that) {           \r\n            that.showLoader();\r\n\t\t\tif(that.options.processInline && !that.options.uploadUrl){\r\n\t\t\t\tif (that.options.onError){\r\n\t\t\t\t\tthat.options.onError.call(that,\"processInline is not supported by your browser \");\r\n\t\t\t\t\tthat.hideLoader();\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tif (that.options.onBeforeImgUpload) that.options.onBeforeImgUpload.call(that);\t\t\t\r\n\t\t\t\tthat.iframeform[0].submit();\r\n\t\t\t}\t\t\t\t\t\t\r\n        },\r\n        getIframeContentJSON: function (iframe) {\r\n            try {                \r\n                var doc = iframe.contentDocument ? iframe.contentDocument : iframe.contentWindow.document,\r\n\t                response;\r\n\r\n                var innerHTML = doc.body.innerHTML;\r\n                if (innerHTML.slice(0, 5).toLowerCase() == \"<pre>\" && innerHTML.slice(-6).toLowerCase() == \"</pre>\") {\r\n                    innerHTML = doc.body.firstChild.firstChild.nodeValue;\r\n                }\r\n                response = jQuery.parseJSON(innerHTML);\r\n            } catch (err) {\r\n                response = { success: false };\r\n            }\r\n\r\n            return response;\r\n        }\r\n\t\t\r\n\t};\r\n})(window, document);\r\n"]}